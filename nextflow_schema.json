{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://raw.githubusercontent.com/DNAmDeconv/master/nextflow_schema.json",
    "title": "DNAmDeconv pipeline parameters",
    "description": "DNA methylation computational deconvolution pipeline.",
    "type": "object",
    "defs": {
        "input_output_options": {
            "title": "Input/output options",
            "type": "object",
            "fa_icon": "fas fa-terminal",
            "description": "Define where the pipeline should find input data and save output data.",
            "required": [
                "outdir"
            ],
            "properties": {
                "input": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "schema": "assets/schema_input.json",
                    "mimetype": "text/csv",
                    "pattern": "^\\S+\\.csv$",
                    "description": "Path to comma-separated file containing information about the reference samples.",
                    "help_text": "You will need to create a design file with information about the samples in your experiment before running the pipeline. Use this parameter to specify its location. It has to be a comma-separated file with 3 columns, and a header row.",
                    "fa_icon": "fas fa-file-csv"
                },
                "test_set": {
                    "type": "string",
                    "description": "Path to comma-separated file containing information about the samples to deconvolve.."
                },
                "outdir": {
                    "type": "string",
                    "format": "directory-path",
                    "description": "The output directory where the results will be saved. You have to use absolute paths to storage on Cloud infrastructure.",
                    "fa_icon": "fas fa-folder-open"
                },
                "ref_matrix": {
                    "type": "string",
                    "pattern": "^\\S+\\.(bed|tsv|txt)$",
                    "format": "file-path",
                    "description": "The path of the reference matrix that you want to use for ref-based deconvolution."
                },
                "merged_matrix": {
                    "type": "string",
                    "pattern": "^\\S+\\.(csv)$",
                    "format": "file-path",
                    "description": "The path of a matrix containing regions and samples where to perform DMR selection."
                }
            }
        },
        "generic_options": {
            "title": "Generic options",
            "type": "object",
            "fa_icon": "fas fa-file-import",
            "description": "Less common options for the pipeline, typically set in a config file.",
            "help_text": "These options are common to all nf-core pipelines and allow you to customise some of the core preferences for how the pipeline runs.\n\nTypically these options would be set in a Nextflow config file loaded for all pipeline runs, such as `~/.nextflow/config`.",
            "properties": {
                "help": {
                    "type": "boolean",
                    "description": "Display help text.",
                    "fa_icon": "fas fa-question-circle",
                    "hidden": true
                },
                "version": {
                    "type": "boolean",
                    "description": "Display version and exit.",
                    "fa_icon": "fas fa-question-circle",
                    "hidden": true
                }
            }
        },
        "deconvolution_options": {
            "title": "Deconvolution options",
            "type": "object",
            "description": "",
            "default": "",
            "properties": {
                "benchmark": {
                    "type": "boolean",
                    "description": "If True, it runs all the tools present in the pipeline"
                },
                "save_intermeds": {
                    "type": "boolean",
                    "description": "Save intermediate files, including single deconvolution tool output files"
                },
                "epidish": {
                    "type": "boolean",
                    "description": "Run the corresponding tool"
                },
                "methyl_resolver": {
                    "type": "boolean",
                    "description": "Run the corresponding tool"
                },
                "episcore": {
                    "type": "boolean",
                    "description": "Run the corresponding tool"
                },
                "prmeth": {
                    "type": "boolean",
                    "description": "Run the corresponding tool"
                },
                "prmeth_rf": {
                    "type": "boolean",
                    "description": "Run the corresponding tool"
                },
                "medecom": {
                    "type": "boolean",
                    "description": "Run the corresponding tool"
                },
                "celfie": {
                    "type": "boolean",
                    "description": "Run the corresponding tool"
                },
                "methyl_atlas": {
                    "type": "boolean",
                    "description": "Run the corresponding tool"
                },
                "cibersort": {
                    "type": "boolean",
                    "description": "Run the corresponding tool"
                },
                "uxm": {
                    "type": "boolean",
                    "description": "Run the corresponding tool"
                },
                "metdecode": {
                    "type": "boolean",
                    "description": "Run the corresponding tool"
                }
            }
        },
        "dmr_analysis_options": {
            "title": "DMR analysis options",
            "type": "object",
            "description": "",
            "default": "",
            "properties": {
                "DMRselection": {
                    "type": "string",
                    "default": "limma",
                    "description": "DMR selection approach adopted"
                },
                "regions": {
                    "type": "string",
                    "description": "Path to region file if DMRselection == \"custom\""
                },
                "adjp": {
                    "type": "number",
                    "default": 0.001,
                    "description": "Adjusted p-value threshold"
                },
                "adj_method": {
                    "type": "string",
                    "default": "BH",
                    "description": "Multiple testing correction method among the ones available in limma R package"
                },
                "collapse_method": {
                    "type": "string",
                    "default": "mean",
                    "description": "Method to collapse the sample values for each region"
                },
                "direction": {
                    "type": "string",
                    "description": "Direction of methylation.",
                    "help_text": "Default takes all the regions: it can be either \"hypo\",\"hyper\",\"both\" or \"random\""
                },
                "top": {
                    "type": "integer",
                    "description": "Take the top x number of DMRs per cell state.",
                    "help_text": "Default is \"None\". It can be used only if \"direction\" flag is specified."
                },
                "big_covs": {
                    "type": "boolean",
                    "description": "If specified, it makes the preprocessing running with a memory-efficient algorithm. Suggested to activate it when using whole-genome coverage files.",
                    "help_text": "Default is false."
                },
                "genome_order": {
                    "type": "string",
                    "description": "If \"--big_cov\" flag is specified, the genome order needs to be specified as well.",
                    "help_text": "Default is \"None\". You can choose among: [human.hg19,human.hg38,human.hg19.nochr,human.hg38.nochr,mouse.mm8,mouse.mm9,mouse.mm10,mouse.mm8.nochr,mouse.mm9.nochr,mouse.mm10.nochr]"
                }
            }
        },
        "dss_options": {
            "title": "DSS options",
            "type": "object",
            "description": "",
            "default": "",
            "properties": {
                "smoothing": {
                    "type": "boolean",
                    "default": "true",
                    "description": "Apply smoothing"
                },
                "smoothing_span": {
                    "type": "number",
                    "default": 500,
                    "description": "Size of smoothing window in base pairs"
                },
                "delta": {
                    "type": "number",
                    "default": 0.1,
                    "description": "Threshold for calling DMRs"
                },
                "min_len": {
                    "type": "number",
                    "default": 50,
                    "description": "Minimum length in base pairs for DMR"
                },
                "dis_merge": {
                    "type": "number",
                    "default": 50,
                    "description": "Maximum distance between DMRs to merge"
                },
                "pct_sign": {
                    "type": "number",
                    "default": 0.5,
                    "description": "Minimum percentage of significant CpGs within a DMR"
                }
            }
        },
        "wgbs_tools_options": {
            "title": "DSS options",
            "type": "object",
            "description": "",
            "default": "",
            "properties": {
                "ref_bams": {
                    "type": "string",
                    "format": "file-path",
                    "schema": "assets/schema_refbams.json",
                    "mimetype": "csv",
                    "pattern": "^\\S+\\.csv$",
                    "description": "Path to comma-separated file containing information about the reference bam samples.",
                    "help_text": "You will need to create a design file with information about the samples in your experiment before running the pipeline. Use this parameter to specify its location. It has to be a comma-separated file with 4 columns, and a header row.",
                    "fa_icon": "fas fa-file-csv"
                },
                "groups_file": {
                    "type": "string",
                    "format": "file-path",
                    "mimetype": "csv",
                    "pattern": "^\\S+\\.csv$",
                    "description": "File (.csv) of the groups.",
                    "fa_icon": "fas fa-file-csv"
                },
                "fasta": {
                    "type":"string",
                    "description": "Path to the genome fasta file used to align samples."
                },
                "genome": {
                    "type":"string",
                    "default": "hg19",
                    "description": "Name of the genome that you want to initialize."
                },
                "max_bp": {
                    "type": "integer",
                    "description": "Maximum length in bp for the blocks.",
                    "default": 2000,
                    "fa_icon": "fas fa-microchip"
                },
                "min_cpg_uxm": {
                    "type": "integer",
                    "description": "Minimum number of CpGs for the blocks.",
                    "default": 3,
                    "fa_icon": "fas fa-microchip"
                },
                "rlen": {
                    "type": "integer",
                    "description":"Minimal CpGs per read required to consider the reads.",
                    "default": 3,
                    "fa_icon": "fas fa-microchip"
                },
                "only_hypo": {
                    "type": "boolean",
                    "description":"Take only hypomethylated markers."
                }
            }
        },
        "options_for_the_preprocessing_of_the_reference_samples": {
            "title": "Options for the preprocessing of the reference samples",
            "type": "object",
            "description": "",
            "default": "",
            "properties": {
                "min_counts": {
                    "type": "integer",
                    "default": 10,
                    "description": "Minimum number of counts to keep a CpG position"
                },
                "min_cpgs": {
                    "type": "integer",
                    "default": 3,
                    "description": "Minimum number of CpGs per region"
                }
            }
        },
        "options_for_the_preprocessing_for_reference_free_tools": {
            "title": "Options for the preprocessing for reference-free tools",
            "type": "object",
            "description": "",
            "default": "",
            "properties": {
                "refree_min_cpgs": {
                    "type": "integer",
                    "default": 3,
                    "description": "Minimum number of counts to keep a CpG position"
                },
                "refree_min_counts": {
                    "type": "integer",
                    "default": 10,
                    "description": "Minimum number of CpGs per region"
                },
                "clusters": {
                    "type": "integer",
                    "default": 2,
                    "description": "Number of cell types expected (necessary for ref-free modality)"
                }
            }
        },
        "medecom_parameters": {
            "title": "MeDeCom parameters",
            "type": "object",
            "description": "",
            "default": "",
            "properties": {
                "ninit": {
                    "type": "integer",
                    "default": 10,
                    "description": "Number of random initializations"
                },
                "nfold": {
                    "type": "integer",
                    "default": 10,
                    "description": "Number of folds for CV"
                },
                "itermax": {
                    "type": "integer",
                    "default": 300,
                    "description": "Max number of iterations"
                }
            }
        },
        "episcore_parameters": {
            "title": "EpiSCORE parameters",
            "type": "object",
            "description": "",
            "default": "",
            "properties": {
                "weight": {
                    "type": "number",
                    "default": 0.4,
                    "description": "Weight parameter used for deconvolution (can go from 0.05 to 0.9)"
                }
            }
        },
        "epidish_parameters": {
            "title": "EpiDISH parameters",
            "type": "object",
            "description": "",
            "default": "",
            "properties": {
                "mod": {
                    "type": "string",
                    "default": "RPC",
                    "description": "EpiDISH deconvolution modality",
                    "help_text": "Alternatives are: [RPC, CBS, CP_ineq, CP_eq]"
                }
            }
        },
        "methylresolver_parameters": {
            "title": "MethylResolver parameters",
            "type": "object",
            "description": "",
            "default": "",
            "properties": {
                "alpha": {
                    "type": "number",
                    "default": 0.5,
                    "description": "Alpha parameter used by the model (can go from 0.5 to 0.9)"
                }
            }
        },
        "prmeth_parameters": {
            "title": "PRMeth parameters",
            "type": "object",
            "description": "",
            "default": "",
            "properties": {
                "prmeth_mod": {
                    "type": "string",
                    "default": "QP",
                    "description": "PRMeth deconv modality",
                    "help_text": "Alternatives are: ['QP', 'NMF'] (ref-based, partial ref-based). PRMeth_RF runs always reference-free deconvolution."
                }
            }
        },
        "celfie_parameters": {
            "title": "CelFiE parameters",
            "type": "object",
            "description": "",
            "default": "",
            "properties": {
                "celfie_maxiter": {
                    "type": "integer",
                    "default": 1000,
                    "description": "How long the EM should iterate before stopping, unless convergence criteria is met"
                },
                "unknown": {
                    "type": "integer",
                    "default": 0,
                    "description": "Number of unknown categories to be estimated along with the reference data"
                },
                "parall_job": {
                    "type": "integer",
                    "default": 1,
                    "description": "Replicate number in a simulation experiment"
                },
                "converg": {
                    "type": "number",
                    "default": 0.0001,
                    "description": "Convergence criteria for EM"
                },
                "celfie_randrest": {
                    "type": "integer",
                    "default": 10,
                    "description": "CelFiE will perform several random restarts and select the one with the highest log-likelihood"
                }
            }
        },
        "uxm_parameters": {
            "title": "UXM parameters",
            "type": "object",
            "description": "",
            "default": "",
            "properties": {
                "test_bams": {
                    "type": "string",
                    "format": "file-path",
                    "schema": "assets/schema_testbams.json",
                    "mimetype": "csv",
                    "pattern": "^\\S+\\.csv$",
                    "description": "Path to comma-separated file containing information about the bam samples to deconvolve.",
                    "help_text": "You will need to create a design file with information about the samples in your experiment before running the pipeline. Use this parameter to specify its location. It has to be a comma-separated file with 3 columns, and a header row.",
                    "fa_icon": "fas fa-file-csv"
                },
                "uxm_atlas": {
                    "type": "string",
                    "format": "file-path",
                    "description": "Path to the uxm-like atlas."
                }
            }
        },
        "metdecode_parameters": {
            "title": "MetDecode parameters",
            "type": "object",
            "description": "",
            "default": "",
            "properties": {
                "unknown_tissues": {
                    "type": "integer",
                    "description": "Number of unknown entities.",
                    "fa_icon": "fas fa-microchip"
                },
                "sum1": {
                    "type": "boolean",
                    "description": "If specified, it makes the sum of the proportions to 1."
                },
                "no_coverage": {
                    "type": "boolean",
                    "description": "Disable CpG coverage factor."
                },
                "supervised": {
                    "type": "boolean",
                    "description": "Disable the unsupervised refinment of the proportions."
                }
            }
        },
        "bismark_parameters": {
            "title": "Bismark parameters",
            "type": "object",
            "description": "",
            "default": "",
            "properties": {
                "bismark_multicore": {
                    "type": "boolean",
                    "description": "If true, activate multicore option"
                },
                "single_end": {
                    "type": "boolean",
                    "description": "If true, bismark will run under 'single_end' option"
                },
                "bismark_buffer_size": {
                    "type": "boolean",
                    "description": "If true, bismark will run with buffer_size option"
                }
            }
        },
        "institutional_config_options": {
            "title": "Institutional config options",
            "type": "object",
            "fa_icon": "fas fa-university",
            "description": "Parameters used to describe centralised config profiles. These should not be edited.",
            "help_text": "The centralised nf-core configuration profiles use a handful of pipeline parameters to describe themselves. This information is then printed to the Nextflow log when you run a pipeline. You should not need to change these values when you run a pipeline.",
            "properties": {
                "config_profile_name": {
                    "type": "string",
                    "description": "Institutional config name.",
                    "hidden": true,
                    "fa_icon": "fas fa-users-cog"
                },
                "config_profile_description": {
                    "type": "string",
                    "description": "Institutional config description.",
                    "hidden": true,
                    "fa_icon": "fas fa-users-cog"
                },
                "monochrome_logs": {
                    "type": "boolean",
                    "description": "Do not use coloured log outputs.",
                    "fa_icon": "fas fa-palette",
                    "hidden": true
                },
                "help": {
                    "type": "boolean",
                    "description": "Display help text.",
                    "fa_icon": "fas fa-question-circle",
                    "hidden": true
                },
                "version": {
                    "type": "boolean",
                    "description": "Display version and exit.",
                    "fa_icon": "fas fa-question-circle",
                    "hidden": true
                },
                "validate_params": {
                    "type": "boolean",
                    "description": "Boolean whether to validate parameters against the schema at runtime",
                    "default": true,
                    "fa_icon": "fas fa-check-square",
                    "hidden": true
                },
                "validationFailUnrecognisedParams": {
                    "type": "boolean",
                    "fa_icon": "far fa-check-circle",
                    "description": "Validation of parameters fails when an unrecognised parameter is found.",
                    "hidden": true,
                    "help_text": "By default, when an unrecognised parameter is found, it returns a warinig."
                },
                "validationLenientMode": {
                    "type": "boolean",
                    "fa_icon": "far fa-check-circle",
                    "description": "Validation of parameters in lenient more.",
                    "hidden": true,
                    "help_text": "Allows string values that are parseable as numbers or booleans. For further information see [JSONSchema docs](https://github.com/everit-org/json-schema#lenient-mode)."
                }
            }
        },
        "max_job_request_options": {
            "title": "Max job request options",
            "type": "object",
            "fa_icon": "fab fa-acquisitions-incorporated",
            "description": "Set the top limit for requested resources for any single job.",
            "help_text": "If you are running on a smaller system, a pipeline step requesting more resources than are available may cause the Nextflow to stop the run with an error. These options allow you to cap the maximum resources requested by any single job so that the pipeline will run on your system.\n\nNote that you can not _increase_ the resources requested by any job using these options. For that you will need your own configuration file. See [the nf-core website](https://nf-co.re/usage/configuration) for details.",
            "properties": {
                "max_cpus": {
                    "type": "integer",
                    "description": "Maximum number of CPUs that can be requested for any single job.",
                    "default": 32,
                    "fa_icon": "fas fa-microchip",
                    "hidden": true,
                    "help_text": "Use to set an upper-limit for the CPU requirement for each process. Should be an integer e.g. `--max_cpus 1`"
                },
                "max_memory": {
                    "type": "string",
                    "description": "Maximum amount of memory that can be requested for any single job.",
                    "default": "64.GB",
                    "fa_icon": "fas fa-memory",
                    "pattern": "^\\d+(\\.\\d+)?\\.?\\s*(K|M|G|T)?B$",
                    "hidden": true,
                    "help_text": "Use to set an upper-limit for the memory requirement for each process. Should be a string in the format integer-unit e.g. `--max_memory '8.GB'`"
                },
                "max_time": {
                    "type": "string",
                    "description": "Maximum amount of time that can be requested for any single job.",
                    "default": "100.h",
                    "fa_icon": "far fa-clock",
                    "pattern": "^(\\d+\\.?\\s*(s|m|h|d|day)\\s*)+$",
                    "hidden": true,
                    "help_text": "Use to set an upper-limit for the time requirement for each process. Should be a string in the format integer-unit e.g. `--max_time '2.h'`"
                }
            }
        }
    },
    "allOf": [
        {
            "$ref": "#/defs/input_output_options"
        },
        {
            "$ref": "#/defs/generic_options"
        },
        {
            "$ref": "#/defs/deconvolution_options"
        },
        {
            "$ref": "#/defs/dmr_analysis_options"
        },
        {
            "$ref": "#/defs/options_for_the_preprocessing_of_the_reference_samples"
        },
        {
            "$ref": "#/defs/options_for_the_preprocessing_for_reference_free_tools"
        },
        {
            "$ref": "#/defs/medecom_parameters"
        },
        {
            "$ref": "#/defs/episcore_parameters"
        },
        {
            "$ref": "#/defs/epidish_parameters"
        },
        {
            "$ref": "#/defs/methylresolver_parameters"
        },
        {
            "$ref": "#/defs/prmeth_parameters"
        },
        {
            "$ref": "#/defs/celfie_parameters"
        }
    ]
}